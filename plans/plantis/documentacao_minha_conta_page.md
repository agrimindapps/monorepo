# Documenta√ß√£o T√©cnica - P√°gina Minha Conta (app-plantas)

## üìã Vis√£o Geral

A p√°gina **Minha Conta** √© o centro de controle do usu√°rio no aplicativo app-plantas, funcionando como hub principal para gerenciamento de perfil, configura√ß√µes, assinatura premium e acesso a funcionalidades administrativas de desenvolvimento. √â uma p√°gina complexa e completa que centraliza praticamente todas as configura√ß√µes e informa√ß√µes do usu√°rio.

## üèóÔ∏è Arquitetura da P√°gina

### Estrutura de Arquivos

```
lib/app-plantas/pages/minha_conta_page/
‚îú‚îÄ‚îÄ bindings/
‚îÇ   ‚îî‚îÄ‚îÄ minha_conta_binding.dart       # Inje√ß√£o de depend√™ncias GetX
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îî‚îÄ‚îÄ minha_conta_controller.dart    # Controller principal com orquestra√ß√£o
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ minha_conta_model.dart         # Modelos de dados da p√°gina
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ data_cleanup_service.dart      # Servi√ßo de limpeza de dados
‚îÇ   ‚îú‚îÄ‚îÄ minha_conta_service.dart       # Servi√ßo principal da p√°gina
‚îÇ   ‚îú‚îÄ‚îÄ navigation_service.dart        # Servi√ßo de navega√ß√£o e URLs
‚îÇ   ‚îú‚îÄ‚îÄ test_data_service.dart         # Servi√ßo de gera√ß√£o de dados de teste
‚îÇ   ‚îî‚îÄ‚îÄ theme_service.dart             # Servi√ßo de gerenciamento de tema
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îî‚îÄ‚îÄ minha_conta_view.dart          # Interface principal da p√°gina
‚îú‚îÄ‚îÄ widgets/
‚îÇ   ‚îú‚îÄ‚îÄ development_section_widget.dart    # Se√ß√£o de desenvolvimento
‚îÇ   ‚îú‚îÄ‚îÄ menu_item_widget.dart              # Widget de item de menu reutiliz√°vel
‚îÇ   ‚îú‚îÄ‚îÄ subscription_card_widget.dart      # Card de assinatura premium
‚îÇ   ‚îî‚îÄ‚îÄ user_profile_card_widget.dart      # Card do perfil do usu√°rio
‚îú‚îÄ‚îÄ issues.md                          # Documenta√ß√£o de melhorias
‚îî‚îÄ‚îÄ index.dart                         # Arquivo de exporta√ß√£o
```

## üé® Interface Visual

### Layout Geral
A p√°gina utiliza um **Scaffold** com:
- **SafeArea** para compatibilidade com diferentes dispositivos
- **Column** principal com header fixo e corpo scroll√°vel
- **BottomNavigationBar** integrada (`AppBottomNavWidget`)

### Cores e Tema
Utiliza o sistema **PlantasColors** para suporte completo a temas claro e escuro:

#### Cores Principais:
- **Background**: `PlantasColors.surfaceColor`
  - Claro: `#FFFFFF`
  - Escuro: `#1A1A1A`
- **Cards**: `PlantasColors.cardColor`
  - Claro: `#FFFFFF`
  - Escuro: `#363636`
- **Texto Principal**: `PlantasColors.textColor`
  - Claro: `#000000DE`
  - Escuro: `#FFFFFF`
- **Texto Secund√°rio**: `PlantasColors.subtitleColor`
  - Claro: `#757575`
  - Escuro: `#B0B0B0`

### Se√ß√µes da Interface

#### 1. **Header (Topo Fixo)**
```dart
Column(
  children: [
    Text('Minha Conta', fontSize: 28, fontWeight: bold),
    Text('Bem-vindo, Usu√°rio An√¥nimo', fontSize: 14, color: subtitle)
  ]
)
```

#### 2. **Card do Perfil do Usu√°rio**
- **Estado N√£o Logado**: Avatar placeholder + bot√£o "Entrar"
- **Estado Logado**: Avatar personalizado + dados do usu√°rio + badge Premium
- **Menu PopUp**: Editar Perfil, Configura√ß√µes, Sair

#### 3. **Card de Assinatura**
- **Estado Gratuito**: Lista de benef√≠cios + bot√£o "Assinar Premium"
- **Estado Premium**: Status da assinatura + informa√ß√µes de cobran√ßa + progress bar

#### 4. **Se√ß√µes de Menu**

##### **Configura√ß√µes**
```dart
MenuSection(
  items: [
    MenuItem('Notifica√ß√µes', 'Configure quando ser notificado'),
    MenuItem('Tema', 'Personalize a apar√™ncia do app') // Com switch
  ]
)
```

##### **Suporte**
```dart
MenuSection(
  items: [
    MenuItem('Enviar Feedback', 'Nos ajude a melhorar o app'),
    MenuItem('Avaliar o App', 'Avalie nossa experi√™ncia')
  ]
)
```

##### **Legal**
```dart
MenuSection(
  items: [
    MenuItem('Pol√≠tica de Privacidade', 'Como protegemos seus dados'),
    MenuItem('Termos de Uso', 'Termos e condi√ß√µes de uso'),
    MenuItem('Sobre o App', 'Vers√£o e informa√ß√µes do app')
  ]
)
```

##### **Desenvolvimento (Se√ß√£o Especial)**
- Gerar Dados de Teste
- Limpar Todos os Registros
- P√°gina Promocional
- Gerenciar Licen√ßa Local

#### 5. **Bot√£o de Sa√≠da**
- Bot√£o vermelho destacado para "Sair do App Plantas"
- Confirma√ß√£o via dialog antes da a√ß√£o

## üíæ Modelos de Dados

### MinhaContaModel (Estado Principal)
```dart
class MinhaContaModel {
  String? nomeUsuario;              // Nome do usu√°rio logado
  String? emailUsuario;             // Email do usu√°rio
  String? fotoPerfilUrl;            // URL da foto de perfil
  bool isLoggedIn;                  // Status de login
  bool isPremium;                   // Status premium
  bool isLoading;                   // Estado de carregamento
  bool hasError;                    // Estado de erro
  String errorMessage;              // Mensagem de erro
  Map<String, bool> configuracoes;  // Configura√ß√µes do usu√°rio
}
```

**Getters Calculados**:
- `nomeExibicao` - Nome ou "Usu√°rio An√¥nimo"
- `statusUsuario` - "Premium", "Usu√°rio padr√£o" ou "N√£o autenticado"
- `notificacoesAtivas`, `modoEscuro`, etc.

### UserPreferences (Configura√ß√µes)
```dart
class UserPreferences {
  bool notificacoes;           // Notifica√ß√µes ativas
  bool backupAutomatico;       // Backup autom√°tico
  bool modoEscuro;             // Tema escuro
  bool sincronizacaoNuvem;     // Sincroniza√ß√£o
  String idioma;               // Idioma da aplica√ß√£o
  String tema;                 // Tema atual
}
```

### UserProfile (Perfil Detalhado)
```dart
class UserProfile {
  String? nome;                // Nome completo
  String? email;               // Email
  String? telefone;            // Telefone
  String? fotoUrl;             // URL da foto
  DateTime? dataCadastro;      // Data de cria√ß√£o da conta
  DateTime? ultimoLogin;       // √öltimo acesso
}
```

## ‚öôÔ∏è Funcionalidades

### 1. **Gerenciamento de Perfil**
- **Login/Logout**: Integra√ß√£o com `AuthService`
- **Exibi√ß√£o de Dados**: Nome, email, foto, data de cadastro
- **Status Premium**: Badge visual para usu√°rios premium
- **Avatar Din√¢mico**: Imagem de rede ou iniciais do nome

### 2. **Gerenciamento de Assinatura**
- **Card Din√¢mico**: Interface diferente para free/premium
- **Informa√ß√µes Premium**: 
  - Status da assinatura (ativa, cancelada, expirada)
  - Data da pr√≥xima cobran√ßa
  - Valor da assinatura
  - Progress bar do per√≠odo
- **A√ß√µes**: Assinar, gerenciar, restaurar, cancelar

### 3. **Sistema de Configura√ß√µes**
- **Toggle de Tema**: Switch interativo para alternar claro/escuro
- **Navega√ß√£o para Configura√ß√µes**: Placeholder para futuras implementa√ß√µes
- **Notifica√ß√µes**: Placeholder para configura√ß√£o de notifica√ß√µes

### 4. **Navega√ß√£o Externa**
- **URLs Seguras**: Pol√≠tica de Privacidade e Termos de Uso
- **Valida√ß√£o de URLs**: Verifica√ß√£o antes de abrir links externos
- **Tratamento de Erro**: Fallback para URLs que n√£o podem ser abertas

### 5. **Suporte e Feedback**
- **Formul√°rio de Feedback**: Integra√ß√£o com `FeedbackService`
- **Avalia√ß√£o do App**: Placeholder para direcionamento √† loja
- **Di√°logo "Sobre"**: Informa√ß√µes detalhadas do aplicativo

### 6. **Ferramentas de Desenvolvimento**
- **Gera√ß√£o de Dados**: Cria√ß√£o de plantas, espa√ßos e tarefas de teste
- **Limpeza de Dados**: Remo√ß√£o completa ou seletiva de registros
- **Gerenciamento de Licen√ßa**: Ativa√ß√£o/revoga√ß√£o de premium local
- **P√°gina Promocional**: Navega√ß√£o para demo do premium

## üîß L√≥gica de Neg√≥cio (Controller)

### MinhaContaController
**Padr√£o**: Orquestra√ß√£o via services especializados seguindo princ√≠pios SOLID

#### Propriedades Reativas:
```dart
final RxBool isLoading = false.obs;           // Loading geral
final RxBool isGeneratingData = false.obs;    // Gerando dados
final RxBool isCleaningData = false.obs;      // Limpando dados
```

#### Services Utilizados:
- `TestDataService` - Gera√ß√£o de dados de teste
- `DataCleanupService` - Limpeza de dados
- `NavigationService` - Navega√ß√£o e URLs
- `ThemeService` - Gerenciamento de tema

#### M√©todos Principais:

##### **Navega√ß√£o**
```dart
navigateToTermos()         // Abre Termos de Uso
navigateToPoliticas()      // Abre Pol√≠tica de Privacidade
navigateToPromo()          // Navega para p√°gina Premium
navigateToAbout()          // Mostra di√°logo "Sobre"
sendFeedback()             // Mostra formul√°rio de feedback
```

##### **Tema**
```dart
toggleTheme()              // Alterna entre claro/escuro
logThemeDebug()            // Log de informa√ß√µes do tema
```

##### **Desenvolvimento**
```dart
gerarDadosDeTeste()        // Cria dados de exemplo
limparTodosRegistros()     // Remove todos os dados
gerarLicencaLocal()        // Ativa premium local
revogarLicencaLocal()      // Remove premium local
```

### Estados Gerenciados:
- **Loading States** - Para opera√ß√µes ass√≠ncronas
- **Error Handling** - Captura e exibi√ß√£o de erros
- **Success Feedback** - Confirma√ß√µes visuais
- **Operation Tracking** - Preven√ß√£o de opera√ß√µes concorrentes

## üõ†Ô∏è Servi√ßos Especializados

### NavigationService
**Responsabilidade**: Navega√ß√£o externa e interna, valida√ß√£o de URLs

#### Funcionalidades:
- **URLs Externas**: Valida√ß√£o e abertura segura
- **Navega√ß√£o Interna**: Transi√ß√µes animadas
- **Di√°logos**: Modais informativos
- **Placeholders**: Funcionalidades futuras
- **Error Handling**: Tratamento de falhas de navega√ß√£o

#### M√©todos Principais:
```dart
navigateToTermos()         // URL: termos-uso
navigateToPoliticas()      // URL: politica-privacidade  
navigateToPromo()          // P√°gina Premium interna
showAboutDialog()          // Modal com informa√ß√µes do app
showFeedback()             // Formul√°rio de feedback
```

### ThemeService
**Responsabilidade**: Gerenciamento centralizado de tema

#### Funcionalidades:
- **Toggle Theme**: Altern√¢ncia claro/escuro
- **Persist√™ncia**: Salvamento da prefer√™ncia
- **Debug Info**: Logs de estado do tema
- **Global Access**: Acesso unificado via `ThemeManager`

### TestDataService
**Responsabilidade**: Gera√ß√£o de dados para desenvolvimento

#### Dados Gerados:
- **Plantas**: 5-10 plantas com diferentes configura√ß√µes
- **Espa√ßos**: 3-5 espa√ßos variados
- **Tarefas**: M√∫ltiplas tarefas por planta
- **Configura√ß√µes**: Settings de exemplo

### DataCleanupService
**Responsabilidade**: Limpeza seletiva e completa de dados

#### Tipos de Limpeza:
- **Completa**: Remove todos os dados
- **Apenas Teste**: Remove dados gerados
- **Seletiva**: Remove categorias espec√≠ficas
- **Com Confirma√ß√£o**: Dialog antes da a√ß√£o

## üß© Widgets Especializados

### UserProfileCardWidget
**Estado Din√¢mico**: Baseado em `AuthService.isLoggedIn`

#### Estado N√£o Logado:
```dart
Row(
  children: [
    CircleAvatar(child: Icon(person_outline)),
    Column([
      Text('Fazer Login'),
      Text('Entre para sincronizar suas plantas')
    ]),
    ElevatedButton('Entrar')
  ]
)
```

#### Estado Logado:
```dart
Row(
  children: [
    CircleAvatar(backgroundImage: NetworkImage(user.avatarUrl)),
    Column([
      Row([
        Text(user.nomeExibicao),
        if(user.isPremium) PremiumBadge()
      ]),
      Text(user.email),
      Text('Membro desde ${formatDate(user.criadoEm)}')
    ]),
    PopupMenuButton(['Editar Perfil', 'Configura√ß√µes', 'Sair'])
  ]
)
```

### SubscriptionCardWidget
**Estado Din√¢mico**: Baseado em `SubscriptionService.isPremium`

#### Estado Gratuito:
- **Lista de Benef√≠cios**: Primeiros 4 benef√≠cios + contador adicional
- **Bot√£o CTA**: "Assinar Premium" com gradiente dourado
- **Valida√ß√£o**: Verifica√ß√£o de login antes da assinatura

#### Estado Premium:
- **Informa√ß√µes da Assinatura**: Status, plano, pr√≥xima cobran√ßa
- **Progress Bar**: Visualiza√ß√£o do per√≠odo restante
- **Menu de A√ß√µes**: Gerenciar, restaurar, cancelar
- **Cards Informativos**: Pre√ßo e pr√≥xima cobran√ßa

### MenuItemWidget
**Widget Reutiliz√°vel** para itens de menu padronizados:

```dart
MenuItemWidget(
  icon: IconData,           // √çcone do menu
  title: String,            // T√≠tulo principal  
  subtitle: String?,        // Descri√ß√£o opcional
  onTap: VoidCallback,      // A√ß√£o ao tocar
  iconColor: Color?,        // Cor personalizada do √≠cone
  titleColor: Color?        // Cor personalizada do t√≠tulo
)
```

**Caracter√≠sticas**:
- Material Design com efeito ripple
- Chevron autom√°tica √† direita
- Padding e espa√ßamento consistentes
- Suporte a temas claro/escuro

### DevelopmentSectionWidget
**Ferramentas de Desenvolvimento** para ambiente de teste:

#### Funcionalidades:
- **Gerar Dados**: Bot√£o para cria√ß√£o de dados de exemplo
- **Limpar Registros**: Bot√£o para limpeza completa
- **P√°gina Promocional**: Acesso r√°pido ao premium
- **Licen√ßa Local**: Gerenciamento de premium de desenvolvimento

## üåê Integra√ß√µes e Depend√™ncias

### Services Externos:
1. **AuthService** - Gerenciamento de autentica√ß√£o
2. **SubscriptionService** - Gerenciamento de assinaturas
3. **ThemeManager** - Controle global de tema
4. **FeedbackService** - Sistema de feedback
5. **LocalLicenseService** - Licen√ßas de desenvolvimento

### P√°ginas Relacionadas:
1. **PremiumPage** - Navega√ß√£o para planos premium
2. **Login/Auth Pages** - Integra√ß√£o de autentica√ß√£o
3. **Settings Pages** - Configura√ß√µes detalhadas (futuro)

### URLs Externas:
- **Termos de Uso**: `https://plantis.agrimind.com.br/termos-uso`
- **Pol√≠tica de Privacidade**: `https://plantis.agrimind.com.br/politica-privacidade`

### Navega√ß√£o:
- **Entrada**: Via `AppBottomNavWidget` (tab "Conta")
- **Sa√≠da**: Dialog de confirma√ß√£o + `Get.offAllNamed('/')`

## üì± Experi√™ncia do Usu√°rio

### Fluxo Principal:
1. **Acesso** ‚Üí Carregamento dos dados do usu√°rio
2. **Visualiza√ß√£o** ‚Üí Cards de perfil e assinatura
3. **Configura√ß√µes** ‚Üí Menu organizado por categorias
4. **A√ß√µes** ‚Üí Navega√ß√£o para funcionalidades espec√≠ficas

### Estados da Interface:
- **Loading**: Shimmer effects nos cards principais
- **Autenticado**: Interface completa com todos os dados
- **N√£o Autenticado**: Incentivo ao login
- **Premium**: Interface diferenciada com recursos exclusivos
- **Desenvolvimento**: Se√ß√£o especial com ferramentas de teste

### Feedback Visual:
- **Sucesso**: Snackbar verde com √≠cone de check
- **Erro**: Snackbar vermelho com mensagem detalhada
- **Info**: Snackbar azul para funcionalidades placeholder
- **Warning**: Snackbar laranja para valida√ß√µes

### Responsividade:
- **Cards Flex√≠veis**: Adapta√ß√£o autom√°tica ao conte√∫do
- **Menu Responsivo**: √çcones e textos bem distribu√≠dos
- **Bottom Navigation**: Integra√ß√£o harmoniosa
- **Safe Area**: Compatibilidade com diferentes dispositivos

## üîí Seguran√ßa e Valida√ß√µes

### Valida√ß√£o de URLs:
```dart
// Valida√ß√£o antes de abrir URLs externas
if (await canLaunchUrl(uri)) {
  await launchUrl(uri, mode: LaunchMode.externalApplication);
} else {
  showError('URL n√£o pode ser aberta');
}
```

### Confirma√ß√µes de A√ß√µes Cr√≠ticas:
- **Logout**: Dialog de confirma√ß√£o
- **Limpeza de Dados**: Dialog com detalhes da a√ß√£o
- **Cancelamento de Assinatura**: Dialog espec√≠fico
- **Sa√≠da do App**: Confirma√ß√£o antes de voltar aos m√≥dulos

### Tratamento de Erros:
- **Try-Catch**: Captura de exce√ß√µes em opera√ß√µes cr√≠ticas
- **Loading States**: Preven√ß√£o de m√∫ltiplas opera√ß√µes
- **Fallbacks**: Alternativas para falhas de servi√ßo
- **User Feedback**: Mensagens claras sobre erros

### Estados de Opera√ß√£o:
```dart
// Preven√ß√£o de opera√ß√µes concorrentes
bool get hasOperationInProgress => 
  isLoading.value || isGeneratingData.value || isCleaningData.value;
```

## üöÄ Melhorias Futuras Identificadas

### Funcionalidades Pendentes:
1. **Configura√ß√µes Avan√ßadas**: P√°gina dedicada para configura√ß√µes detalhadas
2. **Edi√ß√£o de Perfil**: Formul√°rio completo de edi√ß√£o de dados
3. **Notifica√ß√µes**: Sistema completo de gerenciamento de notifica√ß√µes
4. **Backup e Sync**: Funcionalidades de sincroniza√ß√£o de dados
5. **Tema Personalizado**: Al√©m de claro/escuro, cores personaliz√°veis
6. **Idiomas**: Sistema completo de internacionaliza√ß√£o
7. **Estat√≠sticas**: Dashboard com m√©tricas do usu√°rio

### Refatora√ß√µes Sugeridas:
1. **Separa√ß√£o de Widgets**: Extra√ß√£o de componentes reutiliz√°veis
2. **Service Layer**: Amplia√ß√£o dos services especializados
3. **State Management**: Poss√≠vel migra√ß√£o para padr√µes mais robustos
4. **Performance**: Lazy loading para se√ß√µes pesadas
5. **Testes**: Cobertura completa de testes unit√°rios e de integra√ß√£o
6. **Acessibilidade**: Melhorias para usu√°rios com necessidades especiais

### Integra√ß√µes Futuras:
1. **Social Login**: Google, Apple, Facebook
2. **Cloud Storage**: Backup autom√°tico na nuvem
3. **Analytics**: M√©tricas de uso e comportamento
4. **Push Notifications**: Sistema de notifica√ß√µes push
5. **Deep Links**: Links diretos para se√ß√µes espec√≠ficas

---

**Data da Documenta√ß√£o**: Agosto 2025  
**Vers√£o do C√≥digo**: Baseada na estrutura atual do projeto  
**Autor**: Documenta√ß√£o t√©cnica para migra√ß√£o de linguagem

## üìä Estat√≠sticas do C√≥digo

### M√©tricas:
- **Linhas de C√≥digo**: ~2.500 linhas
- **Arquivos**: 14 arquivos principais
- **Services**: 5 services especializados
- **Widgets**: 4 widgets customizados
- **Modelos**: 3 modelos de dados principais
- **Funcionalidades**: 15+ funcionalidades implementadas
- **Estados**: 10+ estados gerenciados
- **Navega√ß√µes**: 8 tipos de navega√ß√£o diferentes