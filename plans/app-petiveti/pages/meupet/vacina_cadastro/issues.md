# Issues e Melhorias - vacina_cadastro

## üìã √çndice Geral

### üî¥ Complexidade ALTA (5 issues)
1. [REFACTOR] - Duplica√ß√£o de l√≥gica de valida√ß√£o entre m√∫ltiplos arquivos
2. [OPTIMIZE] - Performance issues com valida√ß√£o debounced excessiva
3. [SECURITY] - Valida√ß√£o de seguran√ßa inconsistente entre diferentes camadas
4. [REFACTOR] - Acoplamento forte entre controller e m√∫ltiplos servi√ßos
5. [BUG] - Memory leaks potenciais no ControllerLifecycleManager

### üü° Complexidade M√âDIA (7 issues)
6. [STYLE] - Inconsist√™ncias na estrutura de imports e organiza√ß√£o
7. [REFACTOR] - C√≥digo duplicado em valida√ß√µes de data
8. [OPTIMIZE] - Rebuilds desnecess√°rios com m√∫ltiplos Obx() aninhados
9. [TODO] - Falta implementa√ß√£o de cache para melhorar performance
10. [FIXME] - Error handling inconsistente entre diferentes services
11. [REFACTOR] - Constants espalhadas em m√∫ltiplos arquivos de configura√ß√£o
12. [TEST] - Aus√™ncia de testes unit√°rios para validation rules

### üü¢ Complexidade BAIXA (6 issues)
13. [STYLE] - Coment√°rios de documenta√ß√£o inconsistentes
14. [OPTIMIZE] - Uso de magic numbers em alguns locais
15. [STYLE] - Formata√ß√£o inconsistente de strings de erro
16. [NOTE] - Deprecation warnings em alguns m√©todos
17. [DOC] - Falta documenta√ß√£o de arquitetura MVC implementada
18. [STYLE] - Naming conventions inconsistentes entre widgets

---

## üî¥ Complexidade ALTA

### 1. [REFACTOR] - Duplica√ß√£o de l√≥gica de valida√ß√£o entre m√∫ltiplos arquivos

**Status:** üî¥ Pendente | **Execu√ß√£o:** Complexa | **Risco:** Alto | **Benef√≠cio:** Alto

**Descri√ß√£o:** L√≥gica de valida√ß√£o est√° duplicada entre VacinaConfig, VacinaValidationRules, FormValidationService e ValidationMixin. Isso cria inconsist√™ncias e dificulta manuten√ß√£o.

**Prompt de Implementa√ß√£o:** Consolide toda l√≥gica de valida√ß√£o em VacinaValidationRules como single source of truth. Refatore outros arquivos para apenas delegar para esta classe. Remova duplica√ß√µes em VacinaConfig.validateNomeVacina() e m√©todos similares.

**Depend√™ncias:** vacina_config.dart, services/vacina_validation_rules.dart, services/form_validation_service.dart, mixins/validation_mixin.dart

**Valida√ß√£o:** Todas valida√ß√µes devem passar pelos mesmos m√©todos centralizados, sem comportamentos divergentes entre diferentes pontos de entrada.

---

### 2. [OPTIMIZE] - Performance issues com valida√ß√£o debounced excessiva

**Status:** üî¥ Pendente | **Execu√ß√£o:** Complexa | **Risco:** Alto | **Benef√≠cio:** Alto

**Descri√ß√£o:** VacinaCadastroController usa debounce para valida√ß√£o, mas tamb√©m h√° valida√ß√£o em tempo real nos mixins e widgets. Isso causa valida√ß√µes redundantes e impacto na performance.

**Prompt de Implementa√ß√£o:** Implemente estrat√©gia de valida√ß√£o unificada. Use debounce apenas no controller principal, remova valida√ß√µes em tempo real dos widgets. Implemente cache de resultados de valida√ß√£o para evitar rec√°lculos.

**Depend√™ncias:** controllers/vacina_cadastro_controller.dart, mixins/form_state_mixin.dart, views/widgets/vacina_form_widget.dart

**Valida√ß√£o:** Valida√ß√£o deve ocorrer m√°ximo uma vez por campo por intervalo de tempo, com cache funcionando corretamente.

---

### 3. [SECURITY] - Valida√ß√£o de seguran√ßa inconsistente entre diferentes camadas

**Status:** üî¥ Pendente | **Execu√ß√£o:** Complexa | **Risco:** Alto | **Benef√≠cio:** Alto

**Descri√ß√£o:** Padr√µes perigosos s√£o validados em VacinaValidationRules e VacinaConfig, mas com listas diferentes. FormHelpers.hasValidCharacters() usa regex diferente dos outros validadores.

**Prompt de Implementa√ß√£o:** Unifique todas valida√ß√µes de seguran√ßa em VacinaValidationRules. Use mesma lista de caracteres inv√°lidos e padr√µes perigosos em todos pontos. Adicione valida√ß√£o XSS mais robusta.

**Depend√™ncias:** services/vacina_validation_rules.dart, config/vacina_config.dart, utils/form_helpers.dart

**Valida√ß√£o:** Todos inputs devem passar pela mesma valida√ß√£o de seguran√ßa, rejeitando consistentemente caracteres perigosos.

---

### 4. [REFACTOR] - Acoplamento forte entre controller e m√∫ltiplos servi√ßos

**Status:** üî¥ Pendente | **Execu√ß√£o:** Complexa | **Risco:** M√©dio | **Benef√≠cio:** Alto

**Descri√ß√£o:** VacinaCadastroController instancia diretamente VacinaRepository, VaccineCreationService e FormValidationService, criando depend√™ncias r√≠gidas e dificultando testes.

**Prompt de Implementa√ß√£o:** Implemente inje√ß√£o de depend√™ncias usando GetX. Crie interfaces para todos servi√ßos. Refatore controller para receber depend√™ncias via construtor ou GetX.find().

**Depend√™ncias:** controllers/vacina_cadastro_controller.dart, services/vaccine_creation_service.dart, services/form_validation_service.dart

**Valida√ß√£o:** Controller deve funcionar com mocks de todos servi√ßos, facilitando testes unit√°rios.

---

### 5. [BUG] - Memory leaks potenciais no ControllerLifecycleManager

**Status:** üî¥ Pendente | **Execu√ß√£o:** Complexa | **Risco:** Alto | **Benef√≠cio:** Alto

**Descri√ß√£o:** ControllerLifecycleManager mant√©m referencias em mapas que podem n√£o ser limpas corretamente. Timer cleanup pode n√£o ser cancelado em alguns cen√°rios edge case.

**Prompt de Implementa√ß√£o:** Adicione WeakReference onde poss√≠vel. Implemente cleanup autom√°tico em onClose(). Adicione logs para debugging de memory leaks. Considere usar WeakMap ou limpar referencias explicitamente.

**Depend√™ncias:** services/controller_lifecycle_manager.dart

**Valida√ß√£o:** N√£o deve haver crescimento de mem√≥ria ap√≥s m√∫ltiplos ciclos de cria√ß√£o/destrui√ß√£o de controllers.

---

## üü° Complexidade M√âDIA

### 6. [STYLE] - Inconsist√™ncias na estrutura de imports e organiza√ß√£o

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** Baixo | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** Alguns arquivos usam imports relativos, outros absolutos. Ordem de imports n√£o segue padr√£o consistente (dart:, package:, relative).

**Prompt de Implementa√ß√£o:** Padronize ordem de imports: dart: primeiro, depois package:, depois imports relativos. Use dart fix para aplicar automaticamente. Configure linting rules.

**Depend√™ncias:** Todos arquivos .dart na pasta

**Valida√ß√£o:** Todos arquivos devem seguir mesma conven√ß√£o de imports definida no analysis_options.yaml.

---

### 7. [REFACTOR] - C√≥digo duplicado em valida√ß√µes de data

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** Baixo | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** Valida√ß√£o de datas repetida em VacinaConfig.validateDataAplicacao(), VacinaValidationRules.validateApplicationDate() e ValidationMixin.

**Prompt de Implementa√ß√£o:** Centralize valida√ß√£o de datas em VacinaValidationRules. Refatore outros pontos para usar m√©todos centralizados. Remova duplica√ß√£o de l√≥gica de data m√°xima/m√≠nima.

**Depend√™ncias:** config/vacina_config.dart, services/vacina_validation_rules.dart, mixins/validation_mixin.dart

**Valida√ß√£o:** Valida√ß√£o de datas deve ser consistente em todos pontos da aplica√ß√£o.

---

### 8. [OPTIMIZE] - Rebuilds desnecess√°rios com m√∫ltiplos Obx() aninhados

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** M√©dio | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** VacinaFormWidget usa m√∫ltiplos Obx() para diferentes partes do estado, causando rebuilds desnecess√°rios de componentes n√£o relacionados.

**Prompt de Implementa√ß√£o:** Use GetBuilder espec√≠fico ou crie observables granulares. Separe estado de loading, erro e dados em observables independentes. Use RepaintBoundary onde apropriado.

**Depend√™ncias:** views/widgets/vacina_form_widget.dart, controllers/vacina_cadastro_controller.dart

**Valida√ß√£o:** Mudan√ßa em uma parte do estado n√£o deve causar rebuild de outras partes n√£o relacionadas.

---

### 9. [TODO] - Falta implementa√ß√£o de cache para melhorar performance

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** Baixo | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** VacinaConfig define constantes de cache mas n√£o h√° implementa√ß√£o real de cache para valida√ß√µes ou dados de vacinas comuns.

**Prompt de Implementa√ß√£o:** Implemente cache simples usando Map para resultados de valida√ß√£o e sugest√µes de vacinas. Use cache com TTL para evitar dados stale.

**Depend√™ncias:** config/vacina_config.dart, services/form_validation_service.dart

**Valida√ß√£o:** Cache deve melhorar performance de valida√ß√µes repetidas sem afetar funcionalidade.

---

### 10. [FIXME] - Error handling inconsistente entre diferentes services

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** M√©dio | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** VaccineCreationService.getErrorMessage() trata alguns erros, mas outros services n√£o t√™m tratamento padronizado. Mensagens de erro n√£o s√£o localizadas.

**Prompt de Implementa√ß√£o:** Crie classe ErrorHandler centralizada. Padronize tratamento de TimeoutException, SocketException etc em todos services. Adicione localiza√ß√£o para mensagens.

**Depend√™ncias:** services/vaccine_creation_service.dart, controllers/vacina_cadastro_controller.dart

**Valida√ß√£o:** Todos tipos de erro devem ter tratamento consistente e mensagens user-friendly.

---

### 11. [REFACTOR] - Constants espalhadas em m√∫ltiplos arquivos de configura√ß√£o

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** Baixo | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** Constantes est√£o duplicadas entre VaccinationConstants, VacinaConfig e FormConstants. Valores podem ficar inconsistentes.

**Prompt de Implementa√ß√£o:** Consolide todas constantes relacionadas a vacinas em VacinaConfig. Remova duplica√ß√µes de VaccinationConstants. Mantenha apenas constantes de UI em FormConstants.

**Depend√™ncias:** constants/vaccination_constants.dart, config/vacina_config.dart, views/styles/form_constants.dart

**Valida√ß√£o:** Constantes n√£o devem estar duplicadas, com single source of truth para cada valor.

---

### 12. [TEST] - Aus√™ncia de testes unit√°rios para validation rules

**Status:** üü° Pendente | **Execu√ß√£o:** Moderada | **Risco:** M√©dio | **Benef√≠cio:** Alto

**Descri√ß√£o:** VacinaValidationRules cont√©m l√≥gica cr√≠tica de neg√≥cio mas n√£o possui testes automatizados para verificar cen√°rios edge case.

**Prompt de Implementa√ß√£o:** Crie testes unit√°rios abrangentes para todas valida√ß√µes. Teste cen√°rios limite, caracteres especiais, datas inv√°lidas, etc.

**Depend√™ncias:** services/vacina_validation_rules.dart

**Valida√ß√£o:** Todas regras de valida√ß√£o devem ter cobertura de testes > 90%.

---

## üü¢ Complexidade BAIXA

### 13. [STYLE] - Coment√°rios de documenta√ß√£o inconsistentes

**Status:** üü¢ Pendente | **Execu√ß√£o:** Simples | **Risco:** Baixo | **Benef√≠cio:** Baixo

**Descri√ß√£o:** Alguns arquivos t√™m documenta√ß√£o detalhada, outros t√™m coment√°rios m√≠nimos. Falta padr√£o consistente de documenta√ß√£o.

**Prompt de Implementa√ß√£o:** Adicione documenta√ß√£o m√≠nima para todas classes e m√©todos p√∫blicos. Use /// para doc comments. Siga padr√£o dart doc.

**Depend√™ncias:** Todos arquivos .dart na pasta

**Valida√ß√£o:** Todas classes e m√©todos p√∫blicos devem ter documenta√ß√£o b√°sica.

---

### 14. [OPTIMIZE] - Uso de magic numbers em alguns locais

**Status:** üü¢ Pendente | **Execu√ß√£o:** Simples | **Risco:** Baixo | **Benef√≠cio:** Baixo

**Descri√ß√£o:** DatePickerField usa DateTime(1900) diretamente. FormStyles usa valores hardcoded como 0.5 para alpha.

**Prompt de Implementa√ß√£o:** Extraia magic numbers para constantes nomeadas. Use constantes de VacinaConfig onde apropriado.

**Depend√™ncias:** views/widgets/date_picker_field.dart, views/styles/form_styles.dart

**Valida√ß√£o:** N√£o deve haver n√∫meros literais sem contexto no c√≥digo.

---

### 15. [STYLE] - Formata√ß√£o inconsistente de strings de erro

**Status:** üü¢ Pendente | **Execu√ß√£o:** Simples | **Risco:** Baixo | **Benef√≠cio:** Baixo

**Descri√ß√£o:** Algumas mensagens de erro terminam com ponto, outras n√£o. Algumas usam mai√∫sculas, outras min√∫sculas.

**Prompt de Implementa√ß√£o:** Padronize formato de mensagens de erro: primeira letra mai√∫scula, sem ponto final. Use padr√£o consistente para interpola√ß√£o.

**Depend√™ncias:** config/vacina_config.dart, services/vacina_validation_rules.dart

**Valida√ß√£o:** Todas mensagens de erro devem seguir mesmo padr√£o de formata√ß√£o.

---

### 16. [NOTE] - Deprecation warnings em alguns m√©todos

**Status:** üü¢ Pendente | **Execu√ß√£o:** Simples | **Risco:** Baixo | **Benef√≠cio:** Baixo

**Descri√ß√£o:** FormValidationService.sanitizeInput() est√° marcado como deprecated mas ainda usado em alguns locais.

**Prompt de Implementa√ß√£o:** Substitua uso de m√©todos deprecated pelos m√©todos recomendados. Remova m√©todos deprecated se n√£o usado.

**Depend√™ncias:** services/form_validation_service.dart

**Valida√ß√£o:** N√£o deve haver warnings de deprecation no build.

---

### 17. [DOC] - Falta documenta√ß√£o de arquitetura MVC implementada

**Status:** üü¢ Pendente | **Execu√ß√£o:** Simples | **Risco:** Baixo | **Benef√≠cio:** M√©dio

**Descri√ß√£o:** C√≥digo implementa padr√£o MVC mas n√£o h√° documenta√ß√£o explicando a arquitetura e responsabilidades de cada camada.

**Prompt de Implementa√ß√£o:** Adicione README.md explicando arquitetura MVC, fluxo de dados, responsabilidades de Controller/Service/View.

**Depend√™ncias:** Documenta√ß√£o geral da pasta

**Valida√ß√£o:** Desenvolvedores devem conseguir entender arquitetura lendo documenta√ß√£o.

---

### 18. [STYLE] - Naming conventions inconsistentes entre widgets

**Status:** üü¢ Pendente | **Execu√ß√£o:** Simples | **Risco:** Baixo | **Benef√≠cio:** Baixo

**Descri√ß√£o:** VacinaNameField vs DatePickerField - um usa padr√£o portugu√™s, outro ingl√™s para naming de widgets.

**Prompt de Implementa√ß√£o:** Padronize naming para portugu√™s (VacinaNameField, DataPickerField) ou ingl√™s (VaccineNameField, DatePickerField) consistentemente.

**Depend√™ncias:** views/widgets/vacina_name_field.dart, views/widgets/date_picker_field.dart

**Valida√ß√£o:** Todos widgets devem seguir mesma conven√ß√£o de naming definida.