  rules_version = '2';

  service cloud.firestore {
    match /databases/{database}/documents {

      // ===== USUÁRIOS =====
      match /users/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;

        // ===== SUBCOLEÇÕES DO USUÁRIO =====
        match /plants/{plantId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }

        match /tasks/{taskId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }

        match /spaces/{spaceId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }

      // ===== COLEÇÕES RAIZ (caso existam) =====
      match /plants/{plantId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == resource.data.user_id;
        allow create: if request.auth != null &&
          request.auth.uid == request.resource.data.user_id;
      }

      match /tasks/{taskId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == resource.data.user_id;
        allow create: if request.auth != null &&
          request.auth.uid == request.resource.data.user_id;
      }

      match /spaces/{spaceId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == resource.data.user_id;
        allow create: if request.auth != null &&
          request.auth.uid == request.resource.data.user_id;
      }

      // ===== CONFIGURAÇÕES =====
      match /userSettings/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ===== DISPOSITIVOS =====
      match /devices/{deviceId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == resource.data.user_id;
        allow create: if request.auth != null &&
          request.auth.uid == request.resource.data.user_id;
      }

      // ===== DADOS DE SINCRONIZAÇÃO =====
      match /syncData/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // ===== BLOQUEAR TODO O RESTO =====
      match /{document=**} {
        allow read, write: if false;
      }
    }
  }