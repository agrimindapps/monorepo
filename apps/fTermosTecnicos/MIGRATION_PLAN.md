# Plano de MigraÃ§Ã£o fTermosTecnicos â†’ SOLID Featured Pattern

## ğŸ“Š Resumo Executivo
- **Features identificadas**: 4 (Termos, ComentÃ¡rios, Settings, Premium)
- **Use cases estimados**: ~15
- **Estado atual**: 54 arquivos Dart, estrutura plana com GetX
- **Objetivo**: Clean Architecture + Riverpod + Feature-based organization
- **Tempo estimado**: 12-16 horas

## ğŸ¯ Objetivos da MigraÃ§Ã£o
- [x] Analisar estrutura atual
- [ ] Clean Architecture completa (Domain/Data/Presentation)
- [ ] Migrar GetX â†’ Riverpod com code generation
- [ ] Implementar Either<Failure, T> pattern
- [ ] Feature-based organization
- [ ] SOLID principles com specialized services
- [ ] DI com GetIt + Injectable
- [ ] 0 analyzer errors

## ğŸ“ Estrutura Atual vs. Alvo

### Atual (Flat Structure)
```
lib/
â”œâ”€â”€ classes/termo_class.dart
â”œâ”€â”€ repository/termos_repository.dart (Singleton)
â”œâ”€â”€ repository/comentarios_repository.dart
â”œâ”€â”€ pages/ (home, config, comentarios)
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/ (admob, revenuecat, tts, localstorage)
â”‚   â”œâ”€â”€ pages/ (sobre, atualizacao, etc)
â”‚   â”œâ”€â”€ widgets/
â”‚   â””â”€â”€ themes/
â””â”€â”€ hive_models/
```

### Alvo (SOLID Featured)
```
lib/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ constants/
â”‚   â”œâ”€â”€ di/ (dependency injection)
â”‚   â”œâ”€â”€ error/ (failures, exceptions)
â”‚   â”œâ”€â”€ router/
â”‚   â”œâ”€â”€ services/ (specialized services)
â”‚   â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ theme/
â”‚   â””â”€â”€ widgets/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ termos/
â”‚   â”‚   â”œâ”€â”€ data/ (datasources, models, repositories)
â”‚   â”‚   â”œâ”€â”€ domain/ (entities, repositories, usecases)
â”‚   â”‚   â””â”€â”€ presentation/ (pages, providers, widgets)
â”‚   â”œâ”€â”€ comentarios/
â”‚   â”œâ”€â”€ settings/
â”‚   â””â”€â”€ premium/
â””â”€â”€ main.dart
```

## ğŸ”„ FASES DE MIGRAÃ‡ÃƒO

---

## FASE 1: PreparaÃ§Ã£o e Setup (1-2h)

### 1.1 DependÃªncias (pubspec.yaml)

**Adicionar:**
```yaml
dependencies:
  # State Management (from core)
  flutter_riverpod: ^2.6.1
  riverpod_annotation: ^2.6.1

  # Dependency Injection
  get_it: ^8.0.2
  injectable: ^2.5.1

  # Functional Programming
  dartz: ^0.10.1

  # Code Generation (already in dev_dependencies from core)

dev_dependencies:
  riverpod_generator: ^2.4.0
  injectable_generator: ^2.6.2
  custom_lint: ^0.6.4
  riverpod_lint: ^2.3.10
```

**Remover:**
```yaml
dependencies:
  get: ^4.6.6  # Replace with Riverpod + go_router
```

### 1.2 Estrutura de DiretÃ³rios

**Criar estrutura completa:**
```bash
mkdir -p lib/core/{config,constants,di,error,router,services,storage,theme,widgets}
mkdir -p lib/features/termos/{data/{datasources/{local,remote},models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
mkdir -p lib/features/comentarios/{data/{datasources/{local,remote},models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
mkdir -p lib/features/settings/{data/{datasources/local,models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
mkdir -p lib/features/premium/{data/{datasources/local,models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
```

### 1.3 Core Error Handling

**Criar arquivos base:**
- `lib/core/error/failures.dart` - Base Failure class e subclasses
- `lib/core/error/exceptions.dart` - Custom exceptions
- `lib/core/di/injection.dart` - GetIt configuration
- `lib/core/di/injection.config.dart` - Generated by injectable

---

## FASE 2: Feature - Termos TÃ©cnicos (4-6h)

### 2.1 Domain Layer

#### Entities
- [x] `lib/features/termos/domain/entities/termo.dart`
  - Immutable class com freezed/equatable
  - Fields: id, termo, descricao, categoria, favorito

- [x] `lib/features/termos/domain/entities/categoria.dart`
  - Fields: id, descricao, keytermo, keydecripy, image

#### Repository Interface
- [x] `lib/features/termos/domain/repositories/termos_repository.dart`
  ```dart
  abstract class TermosRepository {
    Future<Either<Failure, List<Termo>>> carregarTermos();
    Future<Either<Failure, bool>> toggleFavorito(String termoId);
    Future<Either<Failure, bool>> isFavorito(String termoId);
    Future<Either<Failure, Categoria>> getCategoriaAtual();
    Future<Either<Failure, Unit>> setCategoria(Categoria categoria);
    Future<Either<Failure, List<Categoria>>> getCategorias();
  }
  ```

#### Use Cases (um arquivo por use case)
- [x] `carregar_termos.dart` - LoadTermosUseCase
- [x] `toggle_favorito.dart` - ToggleFavoritoUseCase
- [x] `get_categoria_atual.dart` - GetCategoriaAtualUseCase
- [x] `set_categoria.dart` - SetCategoriaUseCase
- [x] `compartilhar_termo.dart` - CompartilharTermoUseCase
- [x] `copiar_termo.dart` - CopiarTermoUseCase
- [x] `abrir_termo_externo.dart` - AbrirTermoExternoUseCase

### 2.2 Data Layer

#### Models
- [x] `lib/features/termos/data/models/termo_model.dart`
  - Extends Termo entity
  - fromJson/toJson

- [x] `lib/features/termos/data/models/categoria_model.dart`
  - Extends Categoria entity
  - fromJson/toJson

#### Data Sources
- [x] `lib/features/termos/data/datasources/local/termos_local_datasource.dart`
  - Interface + Implementation
  - Methods: loadTermosFromAssets, getFavoritos, setFavorito, getCategoria, setCategoria

- [x] `lib/features/termos/data/datasources/local/database_datasource.dart`
  - Migrar Database class atual
  - Decrypt logic

#### Repository Implementation
- [x] `lib/features/termos/data/repositories/termos_repository_impl.dart`
  - Implements TermosRepository
  - Uses datasources
  - Error handling with try-catch â†’ Either

### 2.3 Presentation Layer

#### Riverpod Providers
- [x] `lib/features/termos/presentation/providers/termos_providers.dart`
  - termosRepositoryProvider
  - carregarTermosUseCaseProvider
  - toggleFavoritoUseCaseProvider
  - etc.

- [x] `lib/features/termos/presentation/providers/termos_state_provider.dart`
  - @riverpod termosNotifier
  - State management com AsyncValue<List<Termo>>
  - Selected categoria state

#### Pages
- [x] Refatorar `lib/features/termos/presentation/pages/home_page.dart`
  - Remove GetX dependencies
  - Use ConsumerWidget
  - ref.watch(termosProvider)

- [x] Migrar `lib/pages/termos_page.dart` â†’ `lib/features/termos/presentation/pages/termos_list_page.dart`

#### Widgets
- [x] Mover widgets especÃ­ficos de termos para `lib/features/termos/presentation/widgets/`
  - categoria_card_widget.dart
  - termo_item_widget.dart
  - etc.

---

## FASE 3: Feature - ComentÃ¡rios (2-3h)

### 3.1 Domain Layer
- [x] Entity: `comentario.dart`
- [x] Repository interface: `comentarios_repository.dart`
- [x] Use cases:
  - `add_comentario.dart`
  - `get_comentarios.dart`
  - `delete_comentario.dart`
  - `update_comentario.dart`

### 3.2 Data Layer
- [x] Model: `comentario_model.dart` (com Hive adapter)
- [x] Local datasource: `comentarios_local_datasource.dart` (Hive)
- [x] Repository implementation

### 3.3 Presentation Layer
- [x] Providers
- [x] Refatorar `comentarios_page.dart`
- [x] Widgets

---

## FASE 4: Feature - Settings (1-2h)

### 4.1 Domain Layer
- [x] Entity: `app_settings.dart` (theme, TTS settings, etc)
- [x] Repository interface
- [x] Use cases:
  - `get_settings.dart`
  - `update_theme.dart`
  - `update_tts_settings.dart`

### 4.2 Data Layer
- [x] Model with SharedPreferences
- [x] Local datasource
- [x] Repository implementation

### 4.3 Presentation Layer
- [x] Providers
- [x] Migrar `config_page.dart` â†’ `settings_page.dart`
- [x] Migrar `tts_settings_page.dart`

---

## FASE 5: Feature - Premium (2-3h)

### 5.1 Domain Layer
- [x] Entity: `subscription_status.dart`
- [x] Repository interface
- [x] Use cases:
  - `check_subscription_status.dart`
  - `restore_purchases.dart`

### 5.2 Data Layer
- [x] Datasource: `premium_datasource.dart` (RevenueCat)
- [x] Repository implementation

### 5.3 Presentation Layer
- [x] Providers
- [x] Migrar `in_app_purchase_page.dart`
- [x] Widgets

---

## FASE 6: Core Refactoring (2-3h)

### 6.1 Services Refactoring
- [x] Migrar services para SOLID pattern:
  - `lib/core/services/tts_service.dart` (specialized)
  - `lib/core/services/share_service.dart` (from use cases)
  - `lib/core/services/clipboard_service.dart`
  - AdMob e RevenueCat jÃ¡ vem do core package

### 6.2 Theme Management
- [x] Migrar para Riverpod:
  - `lib/core/theme/theme_provider.dart`
  - Remove ThemeManager singleton

### 6.3 Router
- [x] Implementar `lib/core/router/app_router.dart`
  - Usar go_router ou Navigator 2.0
  - Remove Get.to/Get.back

### 6.4 Dependency Injection
- [x] Setup completo em `lib/core/di/injection.dart`
- [x] Registrar todos repositories, datasources, use cases

---

## FASE 7: GetX Removal (1-2h)

### 7.1 Navigation
- [x] Replace Get.to â†’ context.push/Navigator
- [x] Replace Get.back â†’ context.pop/Navigator.pop
- [x] Replace GetMaterialApp â†’ MaterialApp + router

### 7.2 State Management
- [x] Verificar que nÃ£o hÃ¡ mais uso de GetX controllers
- [x] Remover import 'package:get/get.dart' de todos arquivos

### 7.3 Cleanup
- [x] Remover get do pubspec.yaml
- [x] flutter pub get
- [x] Verificar que tudo compila

---

## âœ… Checkpoints de ValidaÃ§Ã£o

### Checkpoint 1 (apÃ³s FASE 1)
- [ ] Projeto compila
- [ ] DI configurado
- [ ] Error handling base criado

### Checkpoint 2 (apÃ³s FASE 2)
- [ ] Feature termos funciona end-to-end
- [ ] Favoritos funcionam
- [ ] Compartilhar/copiar funcionam
- [ ] NavegaÃ§Ã£o entre categorias funciona

### Checkpoint 3 (apÃ³s FASE 3)
- [ ] Feature comentÃ¡rios funciona
- [ ] Hive integration funciona

### Checkpoint 4 (apÃ³s FASE 4)
- [ ] Settings funcionam
- [ ] Theme switching funciona
- [ ] TTS settings funcionam

### Checkpoint 5 (apÃ³s FASE 5)
- [ ] Premium/subscription funciona
- [ ] RevenueCat integration funciona

### Checkpoint 6 (apÃ³s FASE 6)
- [ ] Core services funcionam
- [ ] Router funciona
- [ ] Theme management funciona

### Checkpoint 7 (apÃ³s FASE 7)
- [ ] GetX completamente removido
- [ ] NavegaÃ§Ã£o funciona sem GetX
- [ ] flutter analyze = 0 errors
- [ ] flutter test passa (se houver testes)

---

## â±ï¸ Estimativa de Tempo por Fase

| Fase | DescriÃ§Ã£o | Tempo Estimado | Complexidade |
|------|-----------|----------------|--------------|
| 1 | PreparaÃ§Ã£o e Setup | 1-2h | Baixa |
| 2 | Feature - Termos TÃ©cnicos | 4-6h | Alta |
| 3 | Feature - ComentÃ¡rios | 2-3h | MÃ©dia |
| 4 | Feature - Settings | 1-2h | Baixa |
| 5 | Feature - Premium | 2-3h | MÃ©dia |
| 6 | Core Refactoring | 2-3h | MÃ©dia |
| 7 | GetX Removal | 1-2h | Baixa |
| **TOTAL** | | **13-21h** | |

**RecomendaÃ§Ã£o**: Executar em 2-3 dias de trabalho focado.

---

## âš ï¸ Riscos e MitigaÃ§Ãµes

### Risco 1: Perda de Funcionalidade
- **Impacto**: Alto
- **Probabilidade**: MÃ©dia
- **MitigaÃ§Ã£o**: Testes manuais rigorosos apÃ³s cada fase, checkpoints de validaÃ§Ã£o

### Risco 2: Breaking Changes no Core Package
- **Impacto**: MÃ©dio
- **Probabilidade**: Baixa
- **MitigaÃ§Ã£o**: Core package jÃ¡ estÃ¡vel, usar versÃµes do pubspec_overrides.yaml

### Risco 3: Database Migration (Hive)
- **Impacto**: Alto se dados forem perdidos
- **Probabilidade**: Baixa
- **MitigaÃ§Ã£o**: Hive adapters mantidos, apenas wrapper refatorado

### Risco 4: TTS Integration Issues
- **Impacto**: MÃ©dio
- **Probabilidade**: Baixa
- **MitigaÃ§Ã£o**: Manter flutter_tts como estÃ¡, apenas envolver em service layer

---

## ğŸ“š Arquivos de ReferÃªncia

### Gold Standard
- `apps/app-plantis/` - 10/10 Quality Score, arquitetura de referÃªncia
- `apps/app-plantis/lib/features/plants/` - Exemplo de feature completa

### Guias
- `.claude/guides/MIGRATION_PROVIDER_TO_RIVERPOD.md`
- `CLAUDE.md` - PadrÃµes estabelecidos

### Core Package
- `packages/core/` - Services compartilhados (Firebase, RevenueCat, Hive, etc)

---

## ğŸ¯ PrÃ³ximos Passos

1. **Aprovar este plano** com o usuÃ¡rio
2. **Executar FASE 1** (preparaÃ§Ã£o)
3. **Executar FASE 2** (feature termos - a mais complexa)
4. **Validar Checkpoint 2** antes de continuar
5. **Executar FASES 3-7** sequencialmente
6. **ValidaÃ§Ã£o final** com analyzer e testes manuais

---

## ğŸ“ Notas Importantes

- **NÃ£o deletar cÃ³digo antigo imediatamente**: Manter em comentÃ¡rios atÃ© validaÃ§Ã£o completa
- **Commits frequentes**: Um commit por fase/sub-tarefa
- **DocumentaÃ§Ã£o**: Atualizar README.md ao final
- **Testes**: Adicionar testes unitÃ¡rios para use cases apÃ³s migraÃ§Ã£o (opcional mas recomendado)

---

**Criado em**: 2025-10-20
**Status**: Aguardando aprovaÃ§Ã£o para execuÃ§Ã£o
**Ãšltima atualizaÃ§Ã£o**: 2025-10-20
