# Plano de Migração fTermosTecnicos → SOLID Featured Pattern

## 📊 Resumo Executivo
- **Features identificadas**: 4 (Termos, Comentários, Settings, Premium)
- **Use cases estimados**: ~15
- **Estado atual**: 54 arquivos Dart, estrutura plana com GetX
- **Objetivo**: Clean Architecture + Riverpod + Feature-based organization
- **Tempo estimado**: 12-16 horas

## 🎯 Objetivos da Migração
- [x] Analisar estrutura atual
- [ ] Clean Architecture completa (Domain/Data/Presentation)
- [ ] Migrar GetX → Riverpod com code generation
- [ ] Implementar Either<Failure, T> pattern
- [ ] Feature-based organization
- [ ] SOLID principles com specialized services
- [ ] DI com GetIt + Injectable
- [ ] 0 analyzer errors

## 📁 Estrutura Atual vs. Alvo

### Atual (Flat Structure)
```
lib/
├── classes/termo_class.dart
├── repository/termos_repository.dart (Singleton)
├── repository/comentarios_repository.dart
├── pages/ (home, config, comentarios)
├── core/
│   ├── models/
│   ├── services/ (admob, revenuecat, tts, localstorage)
│   ├── pages/ (sobre, atualizacao, etc)
│   ├── widgets/
│   └── themes/
└── hive_models/
```

### Alvo (SOLID Featured)
```
lib/
├── core/
│   ├── config/
│   ├── constants/
│   ├── di/ (dependency injection)
│   ├── error/ (failures, exceptions)
│   ├── router/
│   ├── services/ (specialized services)
│   ├── storage/
│   ├── theme/
│   └── widgets/
├── features/
│   ├── termos/
│   │   ├── data/ (datasources, models, repositories)
│   │   ├── domain/ (entities, repositories, usecases)
│   │   └── presentation/ (pages, providers, widgets)
│   ├── comentarios/
│   ├── settings/
│   └── premium/
└── main.dart
```

## 🔄 FASES DE MIGRAÇÃO

---

## FASE 1: Preparação e Setup (1-2h)

### 1.1 Dependências (pubspec.yaml)

**Adicionar:**
```yaml
dependencies:
  # State Management (from core)
  flutter_riverpod: ^2.6.1
  riverpod_annotation: ^2.6.1

  # Dependency Injection
  get_it: ^8.0.2
  injectable: ^2.5.1

  # Functional Programming
  dartz: ^0.10.1

  # Code Generation (already in dev_dependencies from core)

dev_dependencies:
  riverpod_generator: ^2.4.0
  injectable_generator: ^2.6.2
  custom_lint: ^0.6.4
  riverpod_lint: ^2.3.10
```

**Remover:**
```yaml
dependencies:
  get: ^4.6.6  # Replace with Riverpod + go_router
```

### 1.2 Estrutura de Diretórios

**Criar estrutura completa:**
```bash
mkdir -p lib/core/{config,constants,di,error,router,services,storage,theme,widgets}
mkdir -p lib/features/termos/{data/{datasources/{local,remote},models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
mkdir -p lib/features/comentarios/{data/{datasources/{local,remote},models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
mkdir -p lib/features/settings/{data/{datasources/local,models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
mkdir -p lib/features/premium/{data/{datasources/local,models,repositories},domain/{entities,repositories,usecases},presentation/{pages,providers,widgets}}
```

### 1.3 Core Error Handling

**Criar arquivos base:**
- `lib/core/error/failures.dart` - Base Failure class e subclasses
- `lib/core/error/exceptions.dart` - Custom exceptions
- `lib/core/di/injection.dart` - GetIt configuration
- `lib/core/di/injection.config.dart` - Generated by injectable

---

## FASE 2: Feature - Termos Técnicos (4-6h)

### 2.1 Domain Layer

#### Entities
- [x] `lib/features/termos/domain/entities/termo.dart`
  - Immutable class com freezed/equatable
  - Fields: id, termo, descricao, categoria, favorito

- [x] `lib/features/termos/domain/entities/categoria.dart`
  - Fields: id, descricao, keytermo, keydecripy, image

#### Repository Interface
- [x] `lib/features/termos/domain/repositories/termos_repository.dart`
  ```dart
  abstract class TermosRepository {
    Future<Either<Failure, List<Termo>>> carregarTermos();
    Future<Either<Failure, bool>> toggleFavorito(String termoId);
    Future<Either<Failure, bool>> isFavorito(String termoId);
    Future<Either<Failure, Categoria>> getCategoriaAtual();
    Future<Either<Failure, Unit>> setCategoria(Categoria categoria);
    Future<Either<Failure, List<Categoria>>> getCategorias();
  }
  ```

#### Use Cases (um arquivo por use case)
- [x] `carregar_termos.dart` - LoadTermosUseCase
- [x] `toggle_favorito.dart` - ToggleFavoritoUseCase
- [x] `get_categoria_atual.dart` - GetCategoriaAtualUseCase
- [x] `set_categoria.dart` - SetCategoriaUseCase
- [x] `compartilhar_termo.dart` - CompartilharTermoUseCase
- [x] `copiar_termo.dart` - CopiarTermoUseCase
- [x] `abrir_termo_externo.dart` - AbrirTermoExternoUseCase

### 2.2 Data Layer

#### Models
- [x] `lib/features/termos/data/models/termo_model.dart`
  - Extends Termo entity
  - fromJson/toJson

- [x] `lib/features/termos/data/models/categoria_model.dart`
  - Extends Categoria entity
  - fromJson/toJson

#### Data Sources
- [x] `lib/features/termos/data/datasources/local/termos_local_datasource.dart`
  - Interface + Implementation
  - Methods: loadTermosFromAssets, getFavoritos, setFavorito, getCategoria, setCategoria

- [x] `lib/features/termos/data/datasources/local/database_datasource.dart`
  - Migrar Database class atual
  - Decrypt logic

#### Repository Implementation
- [x] `lib/features/termos/data/repositories/termos_repository_impl.dart`
  - Implements TermosRepository
  - Uses datasources
  - Error handling with try-catch → Either

### 2.3 Presentation Layer

#### Riverpod Providers
- [x] `lib/features/termos/presentation/providers/termos_providers.dart`
  - termosRepositoryProvider
  - carregarTermosUseCaseProvider
  - toggleFavoritoUseCaseProvider
  - etc.

- [x] `lib/features/termos/presentation/providers/termos_state_provider.dart`
  - @riverpod termosNotifier
  - State management com AsyncValue<List<Termo>>
  - Selected categoria state

#### Pages
- [x] Refatorar `lib/features/termos/presentation/pages/home_page.dart`
  - Remove GetX dependencies
  - Use ConsumerWidget
  - ref.watch(termosProvider)

- [x] Migrar `lib/pages/termos_page.dart` → `lib/features/termos/presentation/pages/termos_list_page.dart`

#### Widgets
- [x] Mover widgets específicos de termos para `lib/features/termos/presentation/widgets/`
  - categoria_card_widget.dart
  - termo_item_widget.dart
  - etc.

---

## FASE 3: Feature - Comentários (2-3h)

### 3.1 Domain Layer
- [x] Entity: `comentario.dart`
- [x] Repository interface: `comentarios_repository.dart`
- [x] Use cases:
  - `add_comentario.dart`
  - `get_comentarios.dart`
  - `delete_comentario.dart`
  - `update_comentario.dart`

### 3.2 Data Layer
- [x] Model: `comentario_model.dart` (com Hive adapter)
- [x] Local datasource: `comentarios_local_datasource.dart` (Hive)
- [x] Repository implementation

### 3.3 Presentation Layer
- [x] Providers
- [x] Refatorar `comentarios_page.dart`
- [x] Widgets

---

## FASE 4: Feature - Settings (1-2h)

### 4.1 Domain Layer
- [x] Entity: `app_settings.dart` (theme, TTS settings, etc)
- [x] Repository interface
- [x] Use cases:
  - `get_settings.dart`
  - `update_theme.dart`
  - `update_tts_settings.dart`

### 4.2 Data Layer
- [x] Model with SharedPreferences
- [x] Local datasource
- [x] Repository implementation

### 4.3 Presentation Layer
- [x] Providers
- [x] Migrar `config_page.dart` → `settings_page.dart`
- [x] Migrar `tts_settings_page.dart`

---

## FASE 5: Feature - Premium (2-3h)

### 5.1 Domain Layer
- [x] Entity: `subscription_status.dart`
- [x] Repository interface
- [x] Use cases:
  - `check_subscription_status.dart`
  - `restore_purchases.dart`

### 5.2 Data Layer
- [x] Datasource: `premium_datasource.dart` (RevenueCat)
- [x] Repository implementation

### 5.3 Presentation Layer
- [x] Providers
- [x] Migrar `in_app_purchase_page.dart`
- [x] Widgets

---

## FASE 6: Core Refactoring (2-3h)

### 6.1 Services Refactoring
- [x] Migrar services para SOLID pattern:
  - `lib/core/services/tts_service.dart` (specialized)
  - `lib/core/services/share_service.dart` (from use cases)
  - `lib/core/services/clipboard_service.dart`
  - AdMob e RevenueCat já vem do core package

### 6.2 Theme Management
- [x] Migrar para Riverpod:
  - `lib/core/theme/theme_provider.dart`
  - Remove ThemeManager singleton

### 6.3 Router
- [x] Implementar `lib/core/router/app_router.dart`
  - Usar go_router ou Navigator 2.0
  - Remove Get.to/Get.back

### 6.4 Dependency Injection
- [x] Setup completo em `lib/core/di/injection.dart`
- [x] Registrar todos repositories, datasources, use cases

---

## FASE 7: GetX Removal (1-2h)

### 7.1 Navigation
- [x] Replace Get.to → context.push/Navigator
- [x] Replace Get.back → context.pop/Navigator.pop
- [x] Replace GetMaterialApp → MaterialApp + router

### 7.2 State Management
- [x] Verificar que não há mais uso de GetX controllers
- [x] Remover import 'package:get/get.dart' de todos arquivos

### 7.3 Cleanup
- [x] Remover get do pubspec.yaml
- [x] flutter pub get
- [x] Verificar que tudo compila

---

## ✅ Checkpoints de Validação

### Checkpoint 1 (após FASE 1)
- [ ] Projeto compila
- [ ] DI configurado
- [ ] Error handling base criado

### Checkpoint 2 (após FASE 2)
- [ ] Feature termos funciona end-to-end
- [ ] Favoritos funcionam
- [ ] Compartilhar/copiar funcionam
- [ ] Navegação entre categorias funciona

### Checkpoint 3 (após FASE 3)
- [ ] Feature comentários funciona
- [ ] Hive integration funciona

### Checkpoint 4 (após FASE 4)
- [ ] Settings funcionam
- [ ] Theme switching funciona
- [ ] TTS settings funcionam

### Checkpoint 5 (após FASE 5)
- [ ] Premium/subscription funciona
- [ ] RevenueCat integration funciona

### Checkpoint 6 (após FASE 6)
- [ ] Core services funcionam
- [ ] Router funciona
- [ ] Theme management funciona

### Checkpoint 7 (após FASE 7)
- [ ] GetX completamente removido
- [ ] Navegação funciona sem GetX
- [ ] flutter analyze = 0 errors
- [ ] flutter test passa (se houver testes)

---

## ⏱️ Estimativa de Tempo por Fase

| Fase | Descrição | Tempo Estimado | Complexidade |
|------|-----------|----------------|--------------|
| 1 | Preparação e Setup | 1-2h | Baixa |
| 2 | Feature - Termos Técnicos | 4-6h | Alta |
| 3 | Feature - Comentários | 2-3h | Média |
| 4 | Feature - Settings | 1-2h | Baixa |
| 5 | Feature - Premium | 2-3h | Média |
| 6 | Core Refactoring | 2-3h | Média |
| 7 | GetX Removal | 1-2h | Baixa |
| **TOTAL** | | **13-21h** | |

**Recomendação**: Executar em 2-3 dias de trabalho focado.

---

## ⚠️ Riscos e Mitigações

### Risco 1: Perda de Funcionalidade
- **Impacto**: Alto
- **Probabilidade**: Média
- **Mitigação**: Testes manuais rigorosos após cada fase, checkpoints de validação

### Risco 2: Breaking Changes no Core Package
- **Impacto**: Médio
- **Probabilidade**: Baixa
- **Mitigação**: Core package já estável, usar versões do pubspec_overrides.yaml

### Risco 3: Database Migration (Hive)
- **Impacto**: Alto se dados forem perdidos
- **Probabilidade**: Baixa
- **Mitigação**: Hive adapters mantidos, apenas wrapper refatorado

### Risco 4: TTS Integration Issues
- **Impacto**: Médio
- **Probabilidade**: Baixa
- **Mitigação**: Manter flutter_tts como está, apenas envolver em service layer

---

## 📚 Arquivos de Referência

### Gold Standard
- `apps/app-plantis/` - 10/10 Quality Score, arquitetura de referência
- `apps/app-plantis/lib/features/plants/` - Exemplo de feature completa

### Guias
- `.claude/guides/MIGRATION_PROVIDER_TO_RIVERPOD.md`
- `CLAUDE.md` - Padrões estabelecidos

### Core Package
- `packages/core/` - Services compartilhados (Firebase, RevenueCat, Hive, etc)

---

## 🎯 Próximos Passos

1. **Aprovar este plano** com o usuário
2. **Executar FASE 1** (preparação)
3. **Executar FASE 2** (feature termos - a mais complexa)
4. **Validar Checkpoint 2** antes de continuar
5. **Executar FASES 3-7** sequencialmente
6. **Validação final** com analyzer e testes manuais

---

## 📝 Notas Importantes

- **Não deletar código antigo imediatamente**: Manter em comentários até validação completa
- **Commits frequentes**: Um commit por fase/sub-tarefa
- **Documentação**: Atualizar README.md ao final
- **Testes**: Adicionar testes unitários para use cases após migração (opcional mas recomendado)

---

**Criado em**: 2025-10-20
**Status**: Aguardando aprovação para execução
**Última atualização**: 2025-10-20
